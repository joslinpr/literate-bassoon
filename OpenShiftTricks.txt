     • [1]Book of Knowledge

          • [2]OpenShiftTricks.md
          • [3]Miscellaneous OpenShift / Kubernetes Tricks

               • [4]Get memory, resource usage for a pod
               • [5]Get an interactive shell in a pod
               • [6]Get an interactive shell on a node
               • [7]Get Various Info via CLI:

                    • [8]Get Auth Token:
                    • [9]Pod:
                    • [10]Deployment:
                    • [11]Statefullset:
                    • [12]DeploymentConfig:
                    • [13]BuidConfig:
                    • [14]ImageStream:

               • [15]Role-Based Access Controls (RBAC)

                    • [16]Describe all Role-Based Access Controls
                    • [17]Get Clusterrolebindings (CRB) for
                      user/serviceaccount prometheus-server
                    • [18]Clusterroles (CR) for user/serviceaccount
                      prometheus-server
                    • [19]Local Role Binding Operations
                    • [20]Cluster role binding operations
                    • [21]Converting json to yaml

               • [22]Who’s using kafka?
               • [23]Enable/Disable Cronjobs

                               Book of Knowledge

OpenShiftTricks.md

Miscellaneous OpenShift / Kubernetes Tricks

     • [24]Get memory, resource usage for a pod
     • [25]Get an interactive shell in a pod
     • [26]Get an interactive shell on a node
     • [27]Get Various Info via CLI:
     • [28]Get Auth Token:
     • [29]Pod:
     • [30]Deployment:
     • [31]Statefullset:
     • [32]DeploymentConfig:
     • [33]BuidConfig:
     • [34]ImageStream:
     • [35]Role-Based Access Controls (RBAC)
     • [36]Describe all Role-Based Access Controls
     • [37]Get Clusterrolebindings (CRB) for user/serviceaccount
       prometheus-server
     • [38]Clusterroles (CR) for user/serviceaccount prometheus-server
     • [39]Local Role Binding Operations
     • [40]Cluster role binding operations
     • [41]Converting json to yaml
     • [42]Who’s using kafka?
     • [43]Enable/Disable Cronjobs

  Get memory, resource usage for a pod

 $ oc project ecs-am-ramp-sit-cvg
 $ oc exec sit-cvg-amp-38-hqscx -- cat /sys/fs/cgroup/memory/memory.usage_in_bytes
 # For all running pods in a namespace, use PODMetrics
 $ oc get PODMetrics

  Get an interactive shell in a pod

 $ oc exec -it sit-cvg-amp-38-hqscx -- /bin/bash

     • -i: interactive
     • -t: create a TTY

  Get an interactive shell on a node

 $ oc debug -n default debug/<nodename>

     • Use “chroot /hosts” to access host instead of container
     • You must specify a namespace that does not have a quota.

  Get Various Info via CLI:

    Get Auth Token:

   You must already be logged in.

 TOKEN=$(oc whomai --show-token)

    Pod:

 oc get po '-o=jsonpath={range .items[*]}{"PROG_TEST"},{.metadata.namespace}{","}{.metadata.name}{","}{.spec.containers[].image}{"\n"}' -A |grep redhat

 oc get PODMetrics # Resource Usage for all Running Pods in a Namespace

    Deployment:

 oc get deployment '-o=jsonpath={range .items[*]}{"PRG_TEST"},{.metadata.namespace}{","}{.spec.template.spec.containers[].name}{","}{.spec.template.spec.containers[].image}{"\n"}' -A|grep redhat

    Statefullset:

 oc get sts '-o=jsonpath={range .items[*]}{"PRG_TEST"},{.metadata.namespace}{","}{.spec.template.spec.containers[].name}{","}{.spec.template.spec.containers[].image}{"\n"}' -A|grep redhat

    DeploymentConfig:

 oc get dc '-o=jsonpath={range .items[*]}{"PRG_TEST"},{.metadata.namespace}{","}{.spec.template.spec.containers[].name}{","}{.spec.template.spec.containers[].image}{"\n"}' -A|grep redhat

    BuidConfig:

 oc get bc '-o=jsonpath={range .items[*]}{"PRG_TEST"},{.metadata.namespace}{","}{.metadata.name}{","}{.spec.triggers[].imageChange.lastTriggeredImageID}{"\n"}{end}' -A|grep redhat

    ImageStream:

 oc get is '-o=jsonpath={range .items[*]}{"PRG_TEST"},{.metadata.namespace}{","}{.metadata.name}{","}{.spec.tags[].from.name}{"\n"}{end}' -A|grep redhat

  Role-Based Access Controls (RBAC)

   [44]RBAC References

    Describe all Role-Based Access Controls

   oc describe clusterrole.rbac

    Get Clusterrolebindings (CRB) for user/serviceaccount prometheus-server

   oc get clusterrolebindings -o json | jq '.items[] |
   select(.metadata.name=="prometheus-server")'

    Clusterroles (CR) for user/serviceaccount prometheus-server

   oc get clusterroles -o json | jq '.items[] |
   select(.metadata.name=="prometheus-server")'

    Local Role Binding Operations

   $ oc adm policy who-can <verb> <resource> Indicates which users can
   perform an action on a resource.

   $ oc adm policy add-role-to-user <role> <username> Binds a specified role
   to specified users in the current project.

   $ oc adm policy remove-role-from-user <role> <username> Removes a given
   role from specified users in the current project.

   $ oc adm policy remove-user <username> Removes specified users and all of
   their roles in the current project.

   $ oc adm policy add-role-to-group <role> <groupname> Binds a given role to
   specified groups in the current project.

   $ oc adm policy remove-role-from-group <role> <groupname> Removes a given
   role from specified groups in the current project.

   $ oc adm policy remove-group <groupname> Removes specified groups and all
   of their roles in the current project.

    Cluster role binding operations

   $ oc adm policy add-cluster-role-to-user <role> <username> Binds a given
   role to specified users for all projects in the cluster.

   $ oc adm policy remove-cluster-role-from-user <role> <username> Removes a
   given role from specified users for all projects in the cluster.

   $ oc adm policy add-cluster-role-to-group <role> <groupname> Binds a given
   role to specified groups for all projects in the cluster.

   $ oc adm policy remove-cluster-role-from-group <role> <groupname> Removes
   a given role from specified groups for all projects in the cluster.

    Converting json to yaml

   [45]Converting json to yaml

  Who’s using kafka?

 $ oc get kafka --all-namespaces

  Enable/Disable Cronjobs

 $ oc patch cronjobs <job-name> -p '{"spec" : {"suspend" : true }}' -n <namespace>
 $ oc patch cronjobs <job-name> -p '{"spec" : {"suspend" : false }}' -n <namespace>
